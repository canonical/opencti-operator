# Copyright 2024 Canonical Ltd.
# See LICENSE file for licensing details.

name: opencti-alienvault-connector
title: OpenCTI AlienVault Charm
summary: OpenCTI AlienVault charm.
links:
  documentation: https://discourse.charmhub.io
  issues: https://github.com/canonical/opencti-operator/issues
  source: https://github.com/canonical/opencti-operator
  contact: https://launchpad.net/~canonical-is-devops

description: |
  A [Juju](https://juju.is/) [charm](https://juju.is/docs/olm/charmed-operators) 
  for deploying and managing the [OpenCTI](https://filigran.io/solutions/open-cti/)
  open-source threat intelligence platform in your systems.
  
  This charm simplifies the configuration and maintenance of OpenCTI across a 
  range of environments, organize your cyber threat intelligence to enhance 
  and disseminate actionable insights.

config:
  options:
    alienvault-base-url:
      description: The base URL for the OTX DirectConnect API.
      type: string
    alienvault-excluded-pulse-indicator-types:
      description: The Pulse indicator types that will be excluded from the import.
      type: string
    alienvault-guess-cve:
      description: The Pulse tags are used to guess (checks whether tag matches (CVE-\d{4}-\d{4,7})) vulnerabilities.
      type: boolean
    alienvault-guess-malware:
      description: The Pulse tags are used to guess (queries malwares in the OpenCTI) malwares related to the given Pulse.
      type: boolean
    alienvault-interval-sec:
      description: alienvault interval seconds
      type: int
    alienvault-pulse-start-timestamp:
      description: The Pulses modified after this timestamp will be imported. Timestamp in ISO 8601 format, UTC.
      type: string
    alienvault-report-status:
      description: The status of imported reports in the OpenCTI.
      type: string
    alienvault-tlp:
      description: The default TLP marking used if the Pulse does not define TLP.
      type: string
    connector-duration-period:
      description: Determines the time interval between each launch of the connector in ISO 8601, ex:PT30M.
      type: string
    connector-scope:
      type: string
      description: connector scope
    connector-log-level:
      type: string
      description: determines the verbosity of the logs. Options are debug, info, warn, or error
      default: info
    alienvault-api-key:
      description: (optional) The OTX Key.
      type: string
    alienvault-create-indicators:
      description: (optional) If true then indicators will be created from Pulse indicators and added to the report.
      type: boolean
    alienvault-create-observables:
      description: (optional) If true then observables will be created from Pulse indicators and added to the report.
      type: boolean
    alienvault-default-x-opencti-score:
      description: (optional) The default x_opencti_score to use for indicators. If a per indicator type score is not set, this is used.
      type: int
    alienvault-enable-attack-patterns-indicates:
      description: (optional) If true then the relationshipsindicateswill be created between indicators and attack patterns.
      type: boolean
    alienvault-enable-relationships:
      description: (optional) If true then the relationships will be created between SDOs.
      type: boolean
    alienvault-filter-indicators:
      description: (optional) This boolean filters out indicators created before the latest pulse datetime, ensuring only recent indicators are processed.
      type: boolean
    alienvault-report-type:
      description: (optional) The type of imported reports in the OpenCTI.
      type: string
    alienvault-x-opencti-score-cryptocurrency-wallet:
      description: (optional) The x_opencti_score to use for Cryptocurrency Wallet indicators. If not set, the default value isdefault_x_opencti_score.
      type: int
    alienvault-x-opencti-score-domain:
      description: (optional) The x_opencti_score to use for Domain indicators. If not set, the default value isdefault_x_opencti_score.
      type: int
    alienvault-x-opencti-score-email:
      description: (optional) The x_opencti_score to use for Email indicators. If not set, the default value isdefault_x_opencti_score.
      type: int
    alienvault-x-opencti-score-file:
      description: (optional) The x_opencti_score to use for StixFile indicators. If not set, the default value isdefault_x_opencti_score.
      type: int
    alienvault-x-opencti-score-hostname:
      description: (optional) The x_opencti_score to use for Hostname indicators. If not set, the default value isdefault_x_opencti_score.
      type: int
    alienvault-x-opencti-score-ip:
      description: (optional) The x_opencti_score to use for IP indicators. If not set, the default value isdefault_x_opencti_score.
      type: int
    alienvault-x-opencti-score-mutex:
      description: (optional) The x_opencti_score to use for Mutex indicators. If not set, the default value isdefault_x_opencti_score.
      type: int
    alienvault-x-opencti-score-url:
      description: (optional) The x_opencti_score to use for URL indicators. If not set, the default value isdefault_x_opencti_score.
      type: int
    connector-queue-threshold:
      description: (optional) Used to determine the limit (RabbitMQ) in MB at which the connector must go into buffering mode.
      type: int
    connector-run-and-terminate:
      description: (optional) Launch the connector once if set to True. Takes 2 available values:TrueorFalse.
      type: boolean


provides:
  opencti-connector:
    interface: opencti_connector
    limit: 1

type: charm
base: ubuntu@24.04
build-base: ubuntu@24.04
platforms:
  amd64:
parts:
  charm: {}

containers:
  opencti-alienvault-connector:
    resource: opencti-alienvault-connector-image
resources:
  opencti-alienvault-connector-image:
    type: oci-image
    description: OCI image for the OpenCTI AlienVault connector.

assumes:
  - juju >= 3.4