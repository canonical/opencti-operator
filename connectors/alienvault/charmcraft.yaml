# Copyright 2025 Canonical Ltd.
# See LICENSE file for licensing details.

name: opencti-alienvault-connector
title: OpenCTI AlienVault Charm
summary: OpenCTI AlienVault connector charm.
links:
  documentation: https://discourse.charmhub.io
  issues: https://github.com/canonical/opencti-operator/issues
  source: https://github.com/canonical/opencti-operator
  contact: https://launchpad.net/~canonical-is-devops

description: |
  A [Juju](https://juju.is/) [charm](https://juju.is/docs/olm/charmed-operators) 
  for deploying and managing the [OpenCTI Connectors](https://docs.opencti.io/latest/deployment/connectors/)
  for the OpenCTI charm.
  
  This charm simplifies the configuration and maintenance of OpenCTI Connectors
  across a  range of environments, organize your cyber threat intelligence to
  enhance and disseminate actionable insights.

config:
  options:
    alienvault-api-key:
      description: The OTX Key.
      type: string
      optional: false
    alienvault-interval-sec:
      description: alienvault interval seconds
      type: int
      optional: false
    connector-scope:
      type: string
      description: connector scope
      optional: false
    connector-log-level:
      type: string
      description: determines the verbosity of the logs. Options are debug, info, warn, or error
      default: info
      optional: false
    alienvault-base-url:
      description: (optional) The base URL for the OTX DirectConnect API.
      type: string
      optional: true
    alienvault-create-indicators:
      description: (optional) Create indicators from Pulse indicators.
      type: boolean
      optional: true
    alienvault-create-observables:
      description: (optional) Create observables from Pulse indicators.
      type: boolean
      optional: true
    alienvault-default-x-opencti-score:
      description: (optional) Default x_opencti_score for indicators.
      type: int
      optional: true
    alienvault-enable-attack-patterns-indicates:
      description: (optional) Createindicatesrelationships between indicators and attack patterns.
      type: boolean
      optional: true
    alienvault-enable-relationships:
      description: (optional) Create relationships between SDOs.
      type: boolean
      optional: true
    alienvault-excluded-pulse-indicator-types:
      description: (optional) Comma-separated list of indicator types to exclude (e.g.,FileHash-MD5,FileHash-SHA1).
      type: string
      optional: true
    alienvault-filter-indicators:
      description: (optional) Filter out indicators created before the latest pulse datetime.
      type: boolean
      optional: true
    alienvault-guess-cve:
      description: (optional) Use Pulse tags to detect CVEs.
      type: boolean
      optional: true
    alienvault-guess-malware:
      description: (optional) Use Pulse tags to guess related malware.
      type: boolean
      optional: true
    alienvault-pulse-start-timestamp:
      description: (optional) ISO 8601 timestamp; import Pulses modified after this date.
      type: string
      optional: true
    alienvault-report-status:
      description: (optional) Report status:New,In progress,Analyzed,Closed.
      type: string
      optional: true
    alienvault-report-type:
      description: (optional) Report type in OpenCTI.
      type: string
      optional: true
    alienvault-tlp:
      description: (optional) Default TLP marking if Pulse doesn't define one.
      type: string
      optional: true
    alienvault-x-opencti-score-cryptocurrency-wallet:
      description: (optional) x_opencti_score for Cryptocurrency Wallet indicators.
      type: string
      optional: true
    alienvault-x-opencti-score-domain:
      description: (optional) x_opencti_score for Domain indicators.
      type: string
      optional: true
    alienvault-x-opencti-score-email:
      description: (optional) x_opencti_score for Email indicators.
      type: string
      optional: true
    alienvault-x-opencti-score-file:
      description: (optional) x_opencti_score for File indicators.
      type: string
      optional: true
    alienvault-x-opencti-score-hostname:
      description: (optional) x_opencti_score for Hostname indicators.
      type: string
      optional: true
    alienvault-x-opencti-score-ip:
      description: (optional) x_opencti_score for IP indicators.
      type: string
      optional: true
    alienvault-x-opencti-score-mutex:
      description: (optional) x_opencti_score for Mutex indicators.
      type: string
      optional: true
    alienvault-x-opencti-score-url:
      description: (optional) x_opencti_score for URL indicators.
      type: string
      optional: true
    connector-duration-period:
      description: (optional) Time interval between connector runs in ISO 8601 format.
      type: string
      optional: true


requires:
  logging:
    interface: loki_push_api
    optional: true

provides:
  opencti-connector:
    interface: opencti_connector
    limit: 1

type: charm
base: ubuntu@24.04
build-base: ubuntu@24.04
platforms:
  amd64:
parts:
  charm:
    build-snaps:
      - rustup
    override-build: |
      rustup default stable
      craftctl default
    build-packages:
      - libffi-dev
      - libssl-dev
      - pkg-config

containers:
  opencti-alienvault-connector:
    resource: opencti-alienvault-connector-image
resources:
  opencti-alienvault-connector-image:
    type: oci-image
    description: OCI image for the OpenCTI AlienVault connector.

assumes:
  - juju >= 3.4
